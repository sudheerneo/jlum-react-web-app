"use strict";(()=>{var e={};e.id=611,e.ids=[611],e.modules={1428:e=>{e.exports=import("axios")},3480:(e,t,a)=>{e.exports=a(5600)},4337:e=>{e.exports=import("firebase/firestore")},4722:e=>{e.exports=require("next-auth/react")},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6331:(e,t,a)=>{a.a(e,async(e,s)=>{try{a.r(t),a.d(t,{default:()=>c});var n=a(1428),i=a(4722),o=a(6551),r=a(4337),d=e([n,o,r]);[n,o,r]=d.then?(await d)():d;let u={apiKey:process.env.FIREBASE_apiKey,authDomain:process.env.FIREBASE_authDomain,projectId:process.env.FIREBASE_projectId,storageBucket:process.env.FIREBASE_storageBucket,messagingSenderId:process.env.FIREBASE_messagingSenderId,appId:process.env.FIREBASE_appId,measurementId:process.env.FIREBASE_measurementId},l=(o.default.apps[0]??o.default.initializeApp(u)).firestore(),c=async(e,t)=>{let a=await (0,i.getSession)({req:e}),{bot:s}=e.query,o={"X-Api-Key":"test_e396650e951cdbcc3f3b2aa719b","X-Auth-Token":"test_dc5af79bfc8d3d2354274ea912e"};try{if("POST"===e.method&&"cpRequest"===s){let a=e.body.payload,s=await n.default.post("https://test.instamojo.com/api/1.1/payment-requests/",a,{headers:o}),i=await s.data;t.status(200).json(i)}else if("GET"===e.method&&"redirect"===s){let s=e.query;if("Credit"===s.payment_status){let e=await n.default.get(`https://test.instamojo.com/api/1.1/payments/${s.payment_id}`,{headers:o}),i=await e.data,r=(await l.collection("usersdata").doc(a.user.email).get()).data(),d=await l.collection("usersdata").doc(a.user.email);r?d.update({"donations.lastsuccess":i},{merge:!1})&&d.set({donations:{alldonations:{[i.payment.created_at]:i}}},{merge:!0}):d.set({donations:{lastsuccess:{},lastfail:{},alldonations:{}}},{merge:!0})&&d.update({"donations.lastsuccess":i},{merge:!1})&&d.set({donations:{alldonations:{[i.payment.created_at]:i}}},{merge:!0}),t.status(200).json({"all tests:":"database updated"})}t.status(200).json({response:"currrently analyzing the issue"})}else if("GET"===e.method&&"firedbget"===s){let e={success:!1,payment:{payment_id:"MOJO1803405N95752852",status:"Credit",currency:"INR",amount:"2500.00",buyer_name:"John Doe",buyer_phone:"+919999999999",buyer_email:"foo@example.com",shipping_address:null,shipping_city:null,shipping_state:null,shipping_zip:null,shipping_country:null,quantity:1,unit_price:"2500.00",fees:"47.50",variants:[],custom_fields:{},affiliate_commission:"0",payment_request:"https://test.instamojo.com/api/1.1/payment-requests/39b8e3a1293d431d91f191df9767a4b2/",instrument_type:"NETBANKING",billing_instrument:"Domestic Netbanking Regular",tax_invoice_id:"",failure:null,payout:null,created_at:"2021-08-03T21:05:53.349487Z"}},s=(await l.collection("usersdata").doc(a.user.email).get()).data(),n=await l.collection("usersdata").doc(a.user.email);s?n.update({"donations.lastsuccess":e},{merge:!1})&&n.set({donations:{alldonations:{[e.payment.created_at]:e}}},{merge:!0}):n.set({donations:{lastsuccess:{},lastfail:{},alldonations:{}}},{merge:!0})&&n.update({"donations.lastsuccess":e},{merge:!1})&&n.set({donations:{alldonations:{[e.payment.created_at]:e}}},{merge:!0}),t.status(200).json({"all tests":"databases passed"})}else if("GET"===e.method&&"firedbCreate"===s){let e=l.collection("usersdata").doc(a.user.email);await e.set({"I am":"Sudheer"},{merge:!0}),t.status(200).json({request:"success"})}t.status(200).end()}catch(e){t.status(400).end()}};s()}catch(e){s(e)}})},6370:(e,t,a)=>{a.a(e,async(e,s)=>{try{a.r(t),a.d(t,{config:()=>l,default:()=>u,routeModule:()=>c});var n=a(3480),i=a(8667),o=a(6435),r=a(6331),d=e([r]);r=(d.then?(await d)():d)[0];let u=(0,o.M)(r,"default"),l=(0,o.M)(r,"config"),c=new n.PagesAPIRouteModule({definition:{kind:i.A.PAGES_API,page:"/api/instamojo/[bot]",pathname:"/api/instamojo/[bot]",bundlePath:"",filename:""},userland:r});s()}catch(e){s(e)}})},6435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},6551:e=>{e.exports=import("firebase/app")},8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return a}});var a=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var a=t(t.s=6370);module.exports=a})();